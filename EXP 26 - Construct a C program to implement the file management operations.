#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <fcntl.h>
#include <string.h>

int main() {
    int fd;
    char buffer[100];
    ssize_t bytesRead;

    // 1. Create a new file (or open if it exists)
    fd = open("file_demo.txt", O_CREAT | O_RDWR | O_TRUNC, 0777);
    if (fd < 0) {
        perror("File creation failed");
        exit(1);
    }
    printf("File 'file_demo.txt' created successfully.\n");

    // 2. Write data to file
    char msg[] = "Hello, this is a File Management demo.\n";
    if (write(fd, msg, strlen(msg)) < 0) {
        perror("Write failed");
        exit(1);
    }
    printf("Data written to file.\n");

    // 3. Reposition file pointer to beginning using lseek
    lseek(fd, 0, SEEK_SET);

    // 4. Read data from file
    bytesRead = read(fd, buffer, sizeof(buffer)-1);
    if (bytesRead < 0) {
        perror("Read failed");
        exit(1);
    }
    buffer[bytesRead] = '\0';  
    printf("Data read from file:\n%s", buffer);

    // 5. Append new data
    lseek(fd, 0, SEEK_END);  // move to end of file
    char appendMsg[] = "This is appended text.\n";
    if (write(fd, appendMsg, strlen(appendMsg)) < 0) {
        perror("Append failed");
        exit(1);
    }
    printf("Data appended to file.\n");

    // 6. Close file
    close(fd);
    printf("File closed successfully.\n");

    return 0;
}
